# プロジェクトのバックアップ
Gitを用いてプロジェクトをバックアップします。

本来はブランチを切って`master`ブランチをクリーンに保つとか色々なGitの作法がありますが、今回はプロジェクトのバックアップにのみ興味があるので、全て省略します。

以降の操作は、プロジェクトのディレクトリに移動して行ってください。

```bash
$ cd プロジェクトのディレクトリ
```

## (必要に応じて).gitignoreの編集
GitHubで.gitignoreのPython用のテンプレートは生成されたので、Pythonの一般的なバックアップ不要なファイルは無視されバックアップされませんが、自分で作成したディレクトリ等は必要に応じて追記する必要があります。

例えば、このプロジェクトでは結果を`outputs`ディレクトリ、データセットを`data`ディレクトリに保存していて、これらのファイルはバックアップ対象として適していないので、無視する必要があります。

バックアップすべきではないファイルは以下のような物があります。

- 実行結果やログ等実行時に生成されるファイル
- データセット等実行時にダウンロードされるファイル
- 大きなファイル
- テキスト以外のファイル

Gitではファイルの変更履歴を全て記録するので、上記のようなファイルをバックアップに含めるとGitの履歴が膨大になるので注意しましょう。

特に、テキスト以外のファイル(バイナリファイル)は差分形式で記録されず、何か変更があったら全てを再記録するので、履歴がすぐに膨大になります。

例外として、テスト用の小さな画像を1枚だけリポジトリに含める事もあります。

例として、`outputs/`、`data/`、そしてVSCodeのディレクトリを指定します。以下の内容を`.gitignore`の先頭に記述してください。

```gitignore
# ユーザー追記 ###################
# データセット等のディレクトリ
data/

# 結果のディレクトリ
outputs/

# Visual Studio Codeのディレクトリ
.vscode/
#################################
```

## 変更の追跡対象ファイルの追加
Gitは、`.gitignore`で指定した条件に合致するファイルの変更を記録しませんが、変更の記録を指定していないファイルも同様に変更を記録しません。

まずは、追跡対象になっているファイルとそうでないファイルを確認します。

```bash
$ git status
```

追跡対象になっていないファイルを`git add`で指定する事で追跡対象に指定できます。

```bash
$ git add file.txt
```

全てのファイルが`.gitignore`の無視対象か、追跡対象になっている事を確認したら、コミットしましょう。

## コミット
Gitにファイルの変更を確定させる事を「コミット(Commit)」と呼びます。

コミットには、コミットの分類とタイトル、概要を書きます。

`git commit`コマンドを実行すると、VSCodeで新たなファイルが開かれます。

このファイルの内容は、「コミットメッセージ」と呼ばれ、決まったフォーマットで内容を記述します。

コミットメッセージの一行目に「コミットの分類とタイトル」、三行目に「概要」を書きます。二行目は空行のままにします。

具体的に、それぞれをどのように記述するかは好きなようにしてください。

スタイル例1:

```
Add: グレイスケール画像分類モデル

32×32画素のグレイスケール画像を分類するモデルを定義しました。
```

スタイル例2:

```
Add: Grayscale Image Classification Model

Defined 32px grayscale image classification model. 
```

スタイル例3:

```
追加: グレイスケール画像分類モデル

32×32画素のグレイスケール画像を分類するモデルを定義しました。
```

スタイル例4:

```
【追加】グレイスケール画像分類モデル

32×32画素のグレイスケール画像を分類するモデルを定義しました。
```

コミットの分類について:

|英語|日本語|対応する内容|
|:-:|:-:|:-:|
|Add|追加|ファイルや関数を追加した。|
|Fix|修正|バグを修正した。|
|Improve|改善|実装を改善した。|
|Update|更新|内容を更新した。|
|Remove|削除|ファイルや関数を削除した。|
|Rename|改名|ファイルや関数をリネームした。|
|Move|移動|ファイルを移動した。関数を別ファイルに移動した。|
|Modify|変更|改善でも修正でも更新でもない変更をした。|

```bash
$ git commit
# VSCodeでファイルが開かれるので追記して保存して閉じる
```

### コミットの単位について

どういう単位でバックアップ(コミットとプッシュ)をすると良いのかについて諸説あると思いますが、「プロジェクトのバックアップ」で説明したコミットの分類で分けられる単位で行うべきだと思います。

例えば、こういうコミットメッセージは避けるべきです。

```
AddとFix: モデルの追加と訓練ループの修正

モデルを追加してそれに合わせて訓練ループを修正しました。
```

しかし、コミットの分類を意識するあまり開発に支障が出ては本末転倒なので、今回は自分一人のリポジトリなので、完全に進捗のセーブデータとして使うのもアリだと思います。

```
モデルの作成と訓練ループの定義

モデルを実装して訓練ループを定義しました。
```

## プッシュ
コミットした時点では、ローカルのGitで変更が記録されただけなので、それをリモートに反映します。これを「プッシュ(Push)」と呼びます。

以下のコマンドで実行できます。

```bash
$ git push
```

## プル
GitHubのリポジトリから更新内容を引き出す事を「プル(Pull)」と呼びます。

以下のコマンドで実行できますが、ローカルの変更がコミットされていない場合はエラーになります。

```bash
$ git pull
```

エラーになった場合は、`.venv`のみ`mv`等で退避して、プロジェクトのディレクトリを削除した後、10のプロジェクトのセットアップと同様の手順を踏んだ後、退避した`.venv`を戻すと良いです。

```bash
$ git pull
# エラーになった
# .venvの退避
$ mv .venv ../
$ cd ..
# プロジェクトのディレクトリを削除
# 今回はリポジトリ名から変更していない事とする
$ rm -rf リポジトリ名
$ git clone https://github.com/ユーザー名/リポジトリ名.git
$ mv .venv リポジトリ名/
$ cd リポジトリ名
```
